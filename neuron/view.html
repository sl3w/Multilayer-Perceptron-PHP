<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" href="/neuron/mystyle.css">
</head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<body>
<div class="buttons">
    <button id="init">
        Инициализация
    </button>

    <label>Количество эпох:</label>
    <input id="countEpochs" type="number" min="1" step="100" value="1000">
    <label>Коэф. обучения:</label>
    <input id="teachKoef" type="number" min="0" max="1" step="0.01" value="0.01">

    <button id="teach" disabled>
        Обучение
    </button>

    <label>Тестовые данные:</label>
    <input id="in1" type="number" min="0" step="1" value="1">
    <input id="in2" type="number" min="0" step="1" value="1">
    <input id="in3" type="number" min="0" step="1" value="1">

    <button id="test" disabled>
        Тест
    </button>
</div>

<div class="weights">
<pre id="weights">Текущее значение весов:
</pre>
</div>

<div class="errors">
    <table id="errorsTable">
        <thead>
        <tr>
            <th colspan="3">Ошибки сети</th>
        </tr>
        <tr>
            <th>
                № итер.
            </th>
            <th>
                Кол-во эпох
            </th>
            <th>
                Значение ошибки
            </th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>
<div class="answer">
    <pre></pre>
</div>
</body>

<script>
    var currentWeightsValues;
    var counterIteration = 0;

    $("#init").click(function () {
        $("#teach").attr("disabled", true);
        $("#test").attr("disabled", true);
        counterIteration = 1;
        $.ajax({
            url: "neuro.php",
            type: 'POST',
            dataType: 'json',
            data: {do: 'init'},
            success: function (result) {
                $("#errorsTable td").remove();
                $("#errorsTable tbody tr").remove();
                $(".answer pre").text("");

                let er = result['error'];
                console.log("Ошибка сети: " + er);

                let weights = result['weights'];
                currentWeightsValues = weights;

                let weightsStr = arrayToStr(weights);
                $("#weights").text("Текущее значение весов: \n\n" + weightsStr);

                $("#errorsTable tbody").html("<tr><td>" + counterIteration + "</td><td>1</td><td>" + er + "</td></tr>");

                $("#teach").attr("disabled", false);
                $("#test").attr("disabled", false);
            }
        });
    });

    function arrayToStr(arr) {
        let blkstr = [];
        $.each(arr, function (index, value) {
            blkstr.push(index + ": " + value);
        });
        return blkstr.join("\n");
    }

    $("#teach").click(function () {
        $("#teach").attr("disabled", true);
        $("#test").attr("disabled", true);
        counterIteration++;

        let countEpochs = $("#countEpochs").val();
        let teachKoef = $("#teachKoef").val();

        $.ajax({
            url: "neuro.php",
            type: 'POST',
            dataType: 'json',
            data: {do: 'teach', weights: currentWeightsValues, countEpochs: countEpochs, teachKoef: teachKoef},
            success: function (result) {
                console.log(result);
                let er = result['error'];
                console.log("Ошибка сети: " + er);

                let weights = result['weights'];
                currentWeightsValues = weights;

                let weightsStr = arrayToStr(result['weights']);
                $("#weights").text("Текущее значение весов: \n\n" + weightsStr);

                $("#errorsTable tbody tr:first").before("<tr><td>" + counterIteration + "</td><td>" + countEpochs + "</td><td>" + er + "</td></tr>");

                $("#teach").attr("disabled", false);
                $("#test").attr("disabled", false);
            }
        });
    });

    $("#test").click(function () {
        $("#teach").attr("disabled", true);
        $("#test").attr("disabled", true);

        let in1 = $("#in1").val();
        let in2 = $("#in2").val();
        let in3 = $("#in3").val();

        $.ajax({
            url: "neuro.php",
            type: 'POST',
            dataType: 'json',
            data: {do: 'test', weights: currentWeightsValues, in1: in1, in2: in2, in3: in3},
            success: function (result) {
                console.log(result['answer']);

                $(".answer pre").text("Ответ сети: \n\n" + arrayToStr(result['answer']));
                $("#teach").attr("disabled", false);
                $("#test").attr("disabled", false);
            }
        });
    });
</script>
</html>