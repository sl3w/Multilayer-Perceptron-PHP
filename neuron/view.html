<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" href="/neuron/mystyle.css">
</head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<body>
<div class="buttons">
    <button id="init">
        Инициализация
    </button>
    <button id="teach" disabled>
        Обучение
    </button>
    <label>Количество эпох:</label>
    <input id="countProhodov" type="number" min="100" step="100" value="1000">

    <br>
    <input id="in1" type="number" min="0" step="100" value="1000">
    <input id="in2" type="number" min="0" step="100" value="1000">
    <input id="in3" type="number" min="0" step="100" value="1000">

    <button id="test" disabled>
        Тест
    </button>
</div>

<div class="weights">
<pre id="weights">Текущее значение весов:
</pre>
    <input id="weightsHidden" type="hidden">
</div>

<div class="errors">
    <table id="errorsTable">
        <tr>
            <th>
                Ошибки сети
            </th>
        </tr>
    </table>
</div>
</body>

<script>
    var currentWeightsValues;
    // var currentFuncActValues;
    // var currentAnswersValues;
    var counterIteration = 0;

    $("#init").click(function () {
        $("#teach").attr("disabled", true);
        $("#test").attr("disabled", true);
        counterIteration = 1;
        $.ajax({
            url: "neuro.php",
            type: 'POST',
            dataType: 'json',
            data: {do: 'init'},
            success: function (result) {
                $("#errorsTable td").remove();
                $("#errorsTable tr:not(:first-child)").remove();

                let er = result['error'];
                console.log("Ошибка сети: " + er);

                // currentFuncActValues = result['funcAct'];
                // currentAnswersValues = result['answers'];
                // console.log(currentFuncActValues);
                // console.log(currentAnswersValues);

                let weights = result['weights'];
                currentWeightsValues = weights;

                // $("#weightsHidden").attr("value", weights);

                let weightsStr = arrayToStr(weights);
                $("#weights").text("Текущее значение весов: \n\n" + weightsStr);

                $("#errorsTable tr:first").after("<tr><td>" + counterIteration + "</td>" + "<td>" + er + "</td></tr>");
                $("#teach").attr("disabled", false);
            }
        });
    });

    function arrayToStr(arr) {
        let blkstr = [];
        $.each(arr, function (index, value) {
            blkstr.push(index + ": " + value);
        });
        return blkstr.join("\n");
    }

    $("#teach").click(function () {
        $("#teach").attr("disabled", true);
        $("#test").attr("disabled", true);
        counterIteration++;
        console.log(counterIteration);

        let countProhodov = $("#countProhodov").val();

        console.log(countProhodov);

        $.ajax({
            url: "neuro.php",
            type: 'POST',
            dataType: 'json',
            data: {do: 'teach', weights: currentWeightsValues, countProhodov: countProhodov},
            success: function (result) {
                console.log(result);
                let er = result['error'];
                console.log("Ошибка сети: " + er);

                let weights = result['weights'];
                currentWeightsValues = weights;

                // $("#weightsHidden").attr("value", weights);

                let weightsStr = arrayToStr(result['weights']);
                $("#weights").text("Текущее значение весов: \n\n" + weightsStr);

                $("#errorsTable tr:first").after("<tr><td>" + counterIteration + "</td>" + "<td>" + er + "</td></tr>");


                $("#teach").attr("disabled", false);
                $("#test").attr("disabled", false);
            }
        });
    });

    $("#test").click(function () {
        $("#teach").attr("disabled", true);
        $("#test").attr("disabled", true);
        // counterIteration++;
        // console.log(counterIteration);

        let in1 = $("#in1").val();
        let in2 = $("#in2").val();
        let in3 = $("#in3").val();

        // console.log(countProhodov);

        $.ajax({
            url: "neuro.php",
            type: 'POST',
            dataType: 'json',
            data: {do: 'test', weights: currentWeightsValues, in1: in1, in2: in2, in3: in3},
            success: function (result) {
                console.log(result['answer']);
                // console.log(result);
                // let er = result['error'];
                // console.log("Ошибка сети: " + er);
                //
                // let weights = result['weights'];
                // currentWeightsValues = weights;
                //
                // $("#weightsHidden").attr("value", weights);

                // let weightsStr = arrayToStr(result['weights']);
                // $("#weights").text("Текущее значение весов: \n\n" + weightsStr);
                //
                // $("#errorsTable tr:first").after("<tr><td>" + counterIteration + "</td>" + "<td>" + er + "</td></tr>");
                //
                $("#teach").attr("disabled", false);
                $("#test").attr("disabled", false);
            }
        });
    });
</script>
</html>